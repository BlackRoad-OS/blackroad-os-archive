# Cloudflare Workers Configuration
# https://developers.cloudflare.com/workers/wrangler/configuration/

name = "blackroad-os-archive"
main = "workers/index.ts"
compatibility_date = "2025-12-11"
compatibility_flags = ["nodejs_compat"]

# Account settings (configure via environment or dashboard)
# account_id = "" # Set via CLOUDFLARE_ACCOUNT_ID

[build]
command = "pnpm build:workers || npm run build:workers"

# Production environment
[env.production]
name = "blackroad-os-archive-production"
route = { pattern = "archive.blackroad.io/*", zone_name = "blackroad.io" }

# Staging environment
[env.staging]
name = "blackroad-os-archive-staging"
route = { pattern = "archive-staging.blackroad.io/*", zone_name = "blackroad.io" }

# Development environment
[env.development]
name = "blackroad-os-archive-dev"

# KV Namespaces (create via dashboard or wrangler)
[[kv_namespaces]]
binding = "CACHE"
id = "${CACHE_KV_ID}" # Set via environment variable CACHE_KV_ID
preview_id = "${CACHE_KV_PREVIEW_ID}" # Set via environment variable CACHE_KV_PREVIEW_ID
# To set up KV namespaces, create them via the Cloudflare dashboard or wrangler CLI,
# then set CACHE_KV_ID and CACHE_KV_PREVIEW_ID in your environment before deploying.
# See README.md for setup instructions.
# D1 Database (optional)
# [[d1_databases]]
# binding = "DB"
# database_name = "blackroad-archive"
# database_id = ""

# R2 Bucket (for asset storage)
# [[r2_buckets]]
# binding = "ASSETS"
# bucket_name = "blackroad-assets"

# Environment variables (non-sensitive)
[vars]
ENVIRONMENT = "production"
APP_NAME = "blackroad-os-archive"

# Secrets (set via wrangler secret put)
# - GITHUB_TOKEN
# - API_SECRET

# Triggers
[triggers]
crons = ["0 */6 * * *"]  # Health check every 6 hours

# Observability
[observability]
enabled = true

# Placement hints for performance
[placement]
mode = "smart"
